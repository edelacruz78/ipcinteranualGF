<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Inflación Interanual</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease-in-out;
        }
        .result-card {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .result-card.visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl mx-auto">
        <div class="card p-6 md:p-8">
            <div class="text-center">
                <h1 class="text-2xl md:text-3xl font-bold text-gray-800">Calculadora de Inflación Interanual</h1>
                <p class="mt-2 text-gray-600">Consulte la variación del índice de precios para Guyana y Francia (2017-2021).</p>
            </div>

            <!-- Formulario de entrada -->
            <form id="inflation-form" class="mt-8 space-y-4 md:space-y-0 md:flex md:items-end md:space-x-4">
                <div class="flex-grow">
                    <label for="year-input" class="block text-sm font-medium text-gray-700">Año</label>
                    <input type="number" id="year-input" name="year" placeholder="Ej: 2018" min="2017" max="2021" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <div class="flex-grow">
                    <label for="month-select" class="block text-sm font-medium text-gray-700">Mes</label>
                    <select id="month-select" name="month" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option value="1">Enero</option>
                        <option value="2">Febrero</option>
                        <option value="3">Marzo</option>
                        <option value="4">Abril</option>
                        <option value="5">Mayo</option>
                        <option value="6">Junio</option>
                        <option value="7">Julio</option>
                        <option value="8">Agosto</option>
                        <option value="9">Septiembre</option>
                        <option value="10">Octubre</option>
                        <option value="11">Noviembre</option>
                        <option value="12">Diciembre</option>
                    </select>
                </div>
                <button type="submit" class="w-full md:w-auto bg-indigo-600 text-white px-4 py-2 rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
                    Calcular
                </button>
            </form>

            <!-- Contenedor para resultados y mensajes -->
            <div id="result-container" class="mt-8 min-h-[150px]">
                <!-- El resultado se insertará aquí -->
            </div>
             <div class="mt-4 text-xs text-gray-400 text-center">
                Datos extraídos de: Insee, gy_inf_208.xlsx
            </div>
        </div>
    </div>

    <script>
        // Almacén de datos para la inflación
        const inflationData = {};
        const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

        // Mapeo de meses en francés a su número correspondiente
        const monthMap = {
            'janv.': 1, 'févr.': 2, 'mars': 3, 'avril': 4, 'mai': 5, 'juin': 6,
            'juil.': 7, 'août': 8, 'sept.': 9, 'oct.': 10, 'nov.': 11, 'déc.': 12
        };

        /**
         * Parsea el texto del CSV y lo carga en el objeto inflationData.
         * @param {string} csvText - El contenido del archivo CSV como texto.
         */
        function parseCSV(csvText) {
            const lines = csvText.split('\\n').slice(5); // Omitir las primeras 5 filas de encabezado
            lines.forEach(line => {
                const parts = line.split(',');
                if (parts.length >= 3) {
                    const dateStr = parts[0].trim();
                    const guyaneValue = parts[1].trim();
                    const franceValue = parts[2].trim();

                    const dateParts = dateStr.split(' ');
                    if (dateParts.length === 2) {
                        const monthFR = dateParts[0];
                        const year = parseInt(dateParts[1], 10);
                        const month = monthMap[monthFR];

                        if (year && month) {
                            const key = `${year}-${String(month).padStart(2, '0')}`;
                            inflationData[key] = {
                                guyane: guyaneValue ? parseFloat(guyaneValue.replace(',', '.')) : null,
                                france: franceValue ? parseFloat(franceValue.replace(',', '.')) : null
                            };
                        }
                    }
                }
            });
            console.log("Datos procesados:", inflationData);
        }

        /**
         * Carga los datos del archivo CSV.
         */
        async function loadData() {
            try {
                const response = await fetch('gy_inf_208.xlsx - Figure 1.csv');
                if (!response.ok) {
                    throw new Error(`Error al cargar el archivo: ${response.statusText}`);
                }
                const csvText = await response.text();
                parseCSV(csvText);
            } catch (error) {
                console.error("Error al cargar los datos:", error);
                const resultContainer = document.getElementById('result-container');
                resultContainer.innerHTML = `
                    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md" role="alert">
                        <p class="font-bold">Error</p>
                        <p>No se pudo cargar el archivo de datos. Por favor, asegúrese de que 'gy_inf_208.xlsx - Figure 1.csv' esté disponible.</p>
                    </div>
                `;
            }
        }

        /**
         * Muestra los resultados en la interfaz.
         * @param {number} year - El año consultado.
         * @param {number} month - El mes consultado (1-12).
         * @param {object|null} data - Los datos de inflación para la fecha.
         */
        function displayResult(year, month, data) {
            const resultContainer = document.getElementById('result-container');
            const monthName = monthNames[month - 1];
            
            let contentHTML = '';

            if (data) {
                const guyaneDisplay = data.guyane !== null && !isNaN(data.guyane) ? `${data.guyane.toFixed(1)}%` : 'Dato no disponible';
                const franceDisplay = data.france !== null && !isNaN(data.france) ? `${data.france.toFixed(1)}%` : 'Dato no disponible';
                
                contentHTML = `
                    <div id="result-card" class="result-card text-center p-6 bg-gray-50 rounded-lg">
                        <p class="text-lg text-gray-600">Resultados para <strong>${monthName} de ${year}</strong></p>
                        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                                <h3 class="text-md font-semibold text-gray-500">Guyana</h3>
                                <p class="text-3xl font-bold text-indigo-600 mt-2">${guyaneDisplay}</p>
                            </div>
                            <div class="p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                                <h3 class="text-md font-semibold text-gray-500">Francia</h3>
                                <p class="text-3xl font-bold text-teal-600 mt-2">${franceDisplay}</p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                 contentHTML = `
                    <div id="result-card" class="result-card bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md" role="alert">
                        <p class="font-bold">Sin datos</p>
                        <p>No se encontraron datos para ${monthName} de ${year}.</p>
                    </div>
                `;
            }

            resultContainer.innerHTML = contentHTML;
            // Forzar un reflujo para reiniciar la animación CSS
            const resultCard = document.getElementById('result-card');
            if (resultCard) {
                requestAnimationFrame(() => {
                    resultCard.classList.add('visible');
                });
            }
        }

        // Event listener para el envío del formulario
        document.getElementById('inflation-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const year = document.getElementById('year-input').value;
            const month = document.getElementById('month-select').value;
            
            if (!year) {
                const resultContainer = document.getElementById('result-container');
                resultContainer.innerHTML = `
                    <div id="result-card" class="result-card visible bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md" role="alert">
                        <p>Por favor, introduzca un año válido.</p>
                    </div>
                `;
                return;
            }

            const key = `${year}-${String(month).padStart(2, '0')}`;
            const data = inflationData[key];
            displayResult(parseInt(year), parseInt(month), data);
        });

        // Cargar los datos al iniciar la página
        window.onload = loadData;
    </script>
</body>
</html>
